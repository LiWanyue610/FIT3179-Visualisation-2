{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "description": "Malaysia states - Permanent forest area percentage by year (slider).",
    "width": 700,
    "height": 400,
    "background": "#cfeeff",

    "projection": { "type": "mercator", "center": [109, 4], "scale": 2200 },

    "params": [
        {
        "name": "selectedYear",
        "value": 2021,
        "bind": { "input": "range", "min": 2003, "max": 2021, "step": 1, "name": "Select Year: " }
        }
    ],

    "layer": [
        {
        "name": "graticule",
        "data": { "graticule": { "step": [10, 10] } },
        "mark": { "type": "geoshape", "stroke": "#b8d0e6", "strokeWidth": 0.6, "fill": null }
        },

        {
        "name": "states-outline",
        "data": {
            "url": "https://raw.githubusercontent.com/LiWanyue610/FIT3179-Week9-Homework/refs/heads/main/malaysia-states.topojson",
            "format": { "type": "topojson", "feature": "states" }
        },
        "mark": { "type": "geoshape", "stroke": "#9aa6b2", "strokeWidth": 0.7, "fill": null }
        },

        {
        "name": "choropleth",
        "data": {
            "url": "https://raw.githubusercontent.com/LiWanyue610/FIT3179-Week10-Homework/refs/heads/main/forest_coerage_clean.csv",
            "format": { "type": "csv" }
        },
        "transform": [
            { "calculate": "trim(datum.name)", "as": "name_trim" },
            {
            "calculate": "datum.name_trim == 'Pulau Pinang' ? 'Penang' : (datum.name_trim == 'W.P. Kuala Lumpur / W.P. Labuan / W.P. Putrajaya' ? 'Kuala Lumpur / Labuan / Putrajaya' : datum.name_trim)",
            "as": "state_key"
            },
            { "calculate": "year(toDate(datum.date))", "as": "year_num" },
            { "filter": "datum.year_num == selectedYear" },
            {
            "lookup": "state_key",
            "from": {
                "data": {
                "url": "https://raw.githubusercontent.com/LiWanyue610/FIT3179-Week9-Homework/refs/heads/main/malaysia-states.topojson",
                "format": { "type": "topojson", "feature": "states" }
                },
                "key": "properties.Name"
            },
            "as": "geo"
            },
            { "filter": "datum.geo != null" }
        ],
        "mark": { "type": "geoshape", "stroke": "#666666", "strokeWidth": 0.6 },
        "encoding": {
            "shape": { "field": "geo", "type": "geojson" },
            "color": {
            "field": "forest_cover_rate_percentage",
            "type": "quantitative",
            "title": "Permanent Forest Coverage (%)",
            "scale": {
                "type": "threshold",
                "domain": [10, 20, 30, 40, 50, 60],
                "range": ["#EBFAEA", "#A3EA9F", "#5AD954", "#2CAB26", "#23861D", "#196015", "#051505"]
            },
            "legend": { "orient": "right", "titleLimit": 200, "symbolType": "square" }
            },
            "tooltip": [
            { "field": "state_key", "type": "nominal", "title": "State:" },
            { "field": "year_num", "type": "quantitative", "title": "Year:" },
            { "field": "forest_cover_rate_percentage", "type": "quantitative", "title": "Forest Coverage (%):", "format": ".1f" }
            ]
        }
        }
    ],

    "config": { "view": { "stroke": "transparent" }, "axis": { "domain": false } }
    }